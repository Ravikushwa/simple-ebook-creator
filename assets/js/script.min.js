(function($) {
    "use strict";
    const BASEURL = $('#sec_base_url').val();

    const SimplEbookCreate = {
        initialised: false,
        version: 1.0,
        screenSize: 991,
        collapseScreenSize: 1199,
        init: function(){

            if (!this.initialised) {
                this.initialised = true;
            } else {
                return;
            }

            // Functions Calling
            this.inputfocus();           
            this.DataTable();
            this.Auth();
            this.userToggle();
            this.sideBarToggle();
            this.sideMenu();
            this.selectType();
            this.tooltipHover();
            this.preLoader();
            this.tableDropdowns();
            this.tooglePassword();
            this.profilePicture();
            this.users();
        },

        /**************************
            	Function Define
        ***************************/

        /*********************************************
            	input focus start
        *********************************************/    
        inputfocus: function() {
            if ($('.sec-input-wrapper').length > 0) {
                $(document).on('focus', '.sec-input-wrapper input', function() {
                    $(this).parent().addClass('sec-input-value');
                });
                $('.sec-input-wrapper input').blur(function() {
                    var val = $(this).val();
                    if (val.length == 0) {
                        $(this).parent().removeClass('sec-input-value');
                    }
                });

                $(document).on('click', '.sec-input-wrapper label', function() {
                    $(this).siblings('input').focus();
                });

                $('.sec-multi-select-wrap input').focus(function(e) {
                    $(this).parent().addClass('sec-multi-select-dropdown');
                    event.stopPropagation();
                });
                $('body').click(function() {
                    $('.sec-multi-select-wrap input').parent().removeClass('sec-multi-select-dropdown');
                });
                $(".sec-multi-select-wrap,.sec-multi-select-wrap input").on('click', function() {
                    event.stopPropagation();
                });

            };
        },        
        /*********************************************
            data table common function
        *********************************************/            
        DataTable: function() {         
            if ($('#UserTable').length != 0) {
                var user_dtable = $('#UserTable').DataTable({
                    'columnDefs': [{
                        'targets': 0,
                        'searchable': false,
                        'orderable': false,
                        'render': function(data, type, full, meta) {
                            return ' <div class="ebook-checkbox"><input type="checkbox"  class="eb-user-check" type="checkbox" name="user" value="1"><span></span></div>';
                        }
                    }],
                    'dom': 'lBfrtip',
                    'buttons': [{
                        extend: 'excel',
                        text: 'Export',
                        exportOptions: {
                            columns: ['.export-col']
                        }
                    }]
                });
            
                // Handle "Select all" checkbox click
                $('#users-select-all').on('change', function() {
                    var rows = user_dtable.rows({ 'search': 'applied' }).nodes();
                    var isChecked = this.checked;
            
                    // Set checkbox state for all rows
                    $('.eb-user-check', rows).prop('checked', isChecked);
            
                    // Enable/disable delete button
                    toggleDeleteButton();
                });
            
                // Handle individual checkbox change
                $('#UserTable tbody').on('change', '.eb-user-check', function() {
                    var allCheckboxes = $('#UserTable tbody .eb-user-check');
                    var totalChecked = allCheckboxes.filter(':checked').length;
            
                    // Set "Select all" checkbox state
                    var selectAll = $('#users-select-all').get(0);
                    if (totalChecked === allCheckboxes.length) {
                        selectAll.checked = true;
                        selectAll.indeterminate = false;
                    } else if (totalChecked === 0) {
                        selectAll.checked = false;
                        selectAll.indeterminate = false;
                    } else {
                        selectAll.checked = false;
                        selectAll.indeterminate = true; // Show indeterminate state
                    }
            
                    // Enable/disable delete button
                    toggleDeleteButton();
                });
            
                // Function to toggle delete button state
                function toggleDeleteButton() {
                    var anyChecked = $('#UserTable tbody .eb-user-check:checked').length > 0;
                    if (anyChecked) {
                        $('#users-delete-selected').removeClass('ebook-disabled');
                    } else {
                        $('#users-delete-selected').addClass('ebook-disabled');
                    }
                }
            }
            if ($('#booksTable').length != 0) {
                var user_dtable = $('#booksTable').DataTable({
                    'columnDefs': [{
                        'targets': 0,
                        'searchable': false,
                        'orderable': false,
                        'render': function(data, type, full, meta) {
                            return '<div class="ebook-checkbox"><input class="ebook-user-check" type="checkbox" name="user" value="1"><span></span></div>';
                        }
                    }],
                    'dom': 'lBfrtip',
                    'buttons': [{
                        extend: 'excel',
                        text: 'Export',
                        exportOptions: {
                            columns: ['.export-col']
                        }
                    }]
                });
            
                // Handle "Select all" checkbox click
                $('#ebook-select-all').on('change', function() {
                    var rows = user_dtable.rows({ 'search': 'applied' }).nodes();
                    var isChecked = this.checked;
            
                    // Set checkbox state for all rows
                    $('.ebook-user-check', rows).prop('checked', isChecked);
            
                    // Enable/disable delete button
                    toggleDeleteButton();
                });
            
                // Handle individual checkbox change
                $('#booksTable tbody').on('change', '.ebook-user-check', function() {
                    var allCheckboxes = $('#booksTable tbody .ebook-user-check');
                    var totalChecked = allCheckboxes.filter(':checked').length;
            
                    // Set "Select all" checkbox state
                    var selectAll = $('#ebook-select-all').get(0);
                    if (totalChecked === allCheckboxes.length) {
                        selectAll.checked = true;
                        selectAll.indeterminate = false;
                    } else if (totalChecked === 0) {
                        selectAll.checked = false;
                        selectAll.indeterminate = false;
                    } else {
                        selectAll.checked = false;
                        selectAll.indeterminate = true; // Show indeterminate state
                    }
            
                    // Enable/disable delete button
                    toggleDeleteButton();
                });
            
                // Function to toggle delete button state
                function toggleDeleteButton() {
                    var anyChecked = $('#booksTable tbody .ebook-user-check:checked').length > 0;
                    if (anyChecked) {
                        $('#ebook-delete-selected').removeClass('ebook-disabled');
                    } else {
                        $('#ebook-delete-selected').addClass('ebook-disabled');
                    }
                }
            }
            
        },        
        /*********************************************
            Authentication
        *********************************************/ 
        Auth:function(){
            if ($('.ebook-from-box').length != 0) {
                  /** Show password on icon click **/
                $('.sec_show_password').on('click', function() {
                    var atrri_type = $(this).parent().find('input').attr('type');
                    if (atrri_type == 'password') {
                        $(this).parent().find('input').attr('type', 'text');
                    } else {
                        $(this).parent().find('input').attr('type', 'password');
                    }
                });

                /** Login form submit on button click **/
                $('#sec_login_button').on('click', function() {
                    var email = $(this).parents('form').find('input[name="useremail"]').val();
                    var pass = $(this).parents('form').find('input[name="usererpass"]').val();

                    if (email.length == 0) {
                        $(this).parents('form').find('input[name="useremail"]').addClass('sec-input-error');
                        setTimeout(function() {
                            $(this).parents('form').find('input[name="useremail"]').removeClass('sec-input-error');
                        }, 5000);
                        ebook_alert_message('Email is required.', 'error');                        
                        return false;
                    }

                    if (pass.length == 0) {
                        $(this).parents('form').find('input[name="usererpass"]').addClass('sec-input-error');
                        setTimeout(function() {
                            $(this).parents('form').find('input[name="usererpass"]').removeClass('sec-input-error');
                        }, 5000);
                        ebook_alert_message('Password is required.', 'error');                        
                        return false;
                    }

                    var remember = $('#vp_checked:checked').val();

                    if (!ebookValidateEmail(email)) {
                        $(this).parents('form').find('input[name="useremail"]').addClass('sec-input-error');
                        ebook_alert_message('Please enter valid email.', 'error');
                        setTimeout(function() {
                            $(this).parents('form').find('input[name="useremail"]').removeClass('sec-input-error');
                        }, 5000);                        
                        return false;
                    }
                    $(this).text('Please Wait...!');
                    $.ajax({
                        url: BASEURL + 'login',
                        data: {
                            'email': email,
                            'user_pass': pass,
                            'remember': remember
                        },
                        type: "post",
                        success: function(response) {                    
                            var res = jQuery.parseJSON(response);
                           $(this).text('Sign In To Continue');
                            if (res['status'] == 'success') {
                                var message = 'Successfully Login';
                                ebook_alert_message(message, 'success');
                                setTimeout(function(){
                                    window.location.href = BASEURL + 'dashboard';
                                    return false;
                                },2000);
                            } else if (res['status'] == 'not_match') {
                                var message = 'The password you entered for the email ' + email + ' is incorrect.';
                                ebook_alert_message(message, 'error');
                            } else if (res['status'] == 'user_inactive') {
                                var message = 'We have disabled your account temporarily, please contact to administrator.';
                                ebook_alert_message(message, 'error');
                            } else {
                                var message = 'This email is not registered. Kindly check your email or contact to admin.';
                                ebook_alert_message(message, 'error');
                            }                            
                        }
                    });

                });
                             
                /** Login form submit on Press enter key. **/
                $(document).keyup(function(event) {
                    if (event.which === 13) {
                        $("#sec_login_button").click();
                    }
                });

                /** Request for password reset **/
                $(document).on('click', '.reset-user-password',function() {
                    LoaderIN();
                    var email = $(this).parent().find('input').val();
                    if (!ebookValidateEmail(email)) {
                        $(this).parents('form').find('input[name="useremail"]').addClass('ebook-input-error');
                        ebook_alert_message('Please enter valid email.', 'error');
                        setTimeout(function() {
                            $(this).parents('form').find('input[name="useremail"]').removeClass('ebook-input-error');
                        }, 5000);
                        LoaderOut();
                        return false;
                    }

                    $.ajax({
                        url: BASEURL + 'reset-user-pass',
                        data: {
                            'email': email
                        },
                        type: "post",
                        success: function(response) {                           
                            var res = jQuery.parseJSON(response);

                            if (res.status == 1) {
                                ebook_alert_message(res.msg, 'success');
                                setTimeout(function(){window.location.reload();},4000);
                            } else if (res.status == 2) {
                                ebook_alert_message(res.msg, 'error');
                            } else {
                                ebook_alert_message(res.msg, 'error');
                            }                           
                            LoaderOut();
                        }
                    });
                });
            }
        },  
        /*********************************************
            Fix Header User Button
        *********************************************/  
        userToggle: function() {
            var count = 0;
            var counting = 0;
            $('.user-info').on("click", function() {
                if ($(window).width() <= SimplEbookCreate.collapseScreenSize) {
                    if (count == '0') {
                        $('.user-info-box').addClass('show');
                        count++;
                    } else {
                        $('.user-info-box').removeClass('show');
                        count--;
                    }
                    if (counting == '1') {
                        $('.recent-notification').removeClass('show');
                        counting--;
                    }
                }
            });

            $(".user-info-box, .user-info").on('click', function(event) {
                if ($(window).width() <= SimplEbookCreate.collapseScreenSize) {
                    event.stopPropagation();
                }
            });

            $('body').on("click", function() {
                if ($(window).width() <= SimplEbookCreate.collapseScreenSize) {
                    if (count == '1') {
                        $('.user-info-box').removeClass('show');
                        count--;
                    }
                }
            });

        },
        /*********************************************
            Fix Sidebar Toggle
        *********************************************/
        sideBarToggle: function() {
            $(".toggle-btn").on('click', function(e) {
                e.stopPropagation();
                $("body").toggleClass('mini-sidebar');
                $(this).toggleClass('checked');

            });
            $('.sidebar-wrapper').on('click', function(event) {
                event.stopPropagation();
            });

            
            $('#uploadFile').change(function() {
                var filename = $(this).val().split('\\').pop(); // Get selected file name
                $('.ebook-img-title').text(filename); // Update span text with file name
            });
        },
        tableDropdowns: function() {
            /** Tabble Dropdowns **/
            $(document).on('click', ".ebook-action-icon", function(e) {
                if ($(this).closest(".ebook-table-action").find(".ebook-table-dropdown").hasClass("show")) {
                    $(this).closest(".ebook-table-action").find(".ebook-table-dropdown").removeClass("show");
                } else {
                    $(".ebook-action-icon").closest(".ebook-table-action").find(".ebook-table-dropdown").removeClass("show");
                    $(this).closest(".ebook-table-action").find(".ebook-table-dropdown").addClass("show");
                }
            });
            $(document).on('click', "body", function(e) {
                $('.ebook-table-dropdown').removeClass('show');
            });
            $(document).on('click', ".ebook-table-dropdown, .ebook-action-icon", function(e) {
                e.stopPropagation();
            });
        },
        /*********************************************
            Fix Side Menu
        *********************************************/
        sideMenu: function() {
            $('.side-menu-wrap ul li').has('.sub-menu').addClass('has-sub-menu');
            $.sidebarMenu = function(menu) {
                var animationSpeed = 300,
                    subMenuSelector = '.sub-menu';
                $(menu).on('click', 'li a', function(e) {
                    var $this = $(this);
                    var checkElement = $this.next();
                    if (checkElement.is(subMenuSelector) && checkElement.is(':visible')) {
                        checkElement.slideUp(animationSpeed, function() {
                            checkElement.removeClass('menu-show');
                        });
                        checkElement.parent("li").removeClass("active");
                    } else if ((checkElement.is(subMenuSelector)) && (!checkElement.is(':visible'))) {
                        var parent = $this.parents('ul').first();
                        var ul = parent.find('ul:visible').slideUp(animationSpeed);
                        ul.removeClass('menu-show');
                        var parent_li = $this.parent("li");
                        checkElement.slideDown(animationSpeed, function() {
                            checkElement.addClass('menu-show');
                            parent.find('li.active').removeClass('active');
                            parent_li.addClass('active');
                        });
                    }
                    if (checkElement.is(subMenuSelector)) {
                        e.preventDefault();
                    }
                });
            }
            $.sidebarMenu($('.main-menu'));
            $(function() {
                for (var a = window.location, counting = $(".main-menu a").filter(function() {
                        return this.href == a;
                    }).addClass("active").parent().addClass("active");;) {
                    if (!counting.is("li")) break;
                    counting = counting.parent().slideDown().parent().addClass("active");
                }
            });
        },
        /*********************************************
           Fix Custom Select 
        *********************************************/

        selectType: function() {
            if ($('.ebook-dropbtn').length > 0) {
               // Custom Dropdown 
                $(".ebook-dropbtn").on('click', function(event) {
                    event.stopPropagation();
                    $(this).parent().toggleClass("active");
                });
                $("body").on('click', function() {
                    $(".ebook-custom-dropdown").removeClass("active");
                });
                $(".ebook-dropdown-content li").on('click', function(event) {
                    $(".ebook-custom-dropdown").removeClass("active");
                    // Get the text of the clicked li element
                    let dropdownValue = $(this).text().trim();
                    // Set the text of the dropbtn to the text of the clicked li element
                    $(".ebook-dropbtn span").text(dropdownValue);
                    
                });
            }
        },
        /*********************************************
            Fix Toltip
        *********************************************/
        tooltipHover: function() {
            if ($('.toltiped').length > 0) {
                $(function() {
                    $(".toltiped").tooltip();
                });
            }            
        },
        /*********************************************
        	Fix PreLoader
        *********************************************/
        preLoader: function() {
            $(window).on('load', function() {
                $(".status").fadeOut();
                $(".preloader").delay(350).fadeOut("slow");
            });
        },
        /*********************************************
			Fix Hide Show Password
		*********************************************/
        tooglePassword: function() {
            $(".toggle-password").click(function() {
                $(this).toggleClass("show-password");
                var input = $($(this).attr("toggle"));
                if (input.attr("type") == "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            });
            $(".toggle-pass").click(function() {
                $(this).toggleClass("show-pass");
                var input = $($(this).attr("toggle"));
                if (input.attr("type") == "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            });
        }, 
        /*********************************************
        	profilePicture
        *********************************************/
        profilePicture: function() {
           
           
            $(document).on('change', '#profileUpdate', function (e) {
                e.preventDefault();
            
                let fileInput = $(this); // Reference the file input element
                let formData = new FormData();
                formData.append('file', fileInput[0].files[0]);
            
                $.ajax({
                    url: BASEURL + 'user-profile-update', // Adjust the URL to match your CodeIgniter route
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    xhr: function () {
                        let xhr = new XMLHttpRequest();
                        xhr.upload.addEventListener('progress', function (e) {
                            if (e.lengthComputable) {
                                let percentage = Math.round((e.loaded / e.total) * 100);
                                $('#progress').show();
                                $('#progressBar').val(percentage);
                                $('#percentage').text(percentage + '%');
                            }
                        });
                        return xhr;
                    },
                    success: function (response) {
                        let res = jQuery.parseJSON(response);
                        if (res.status === "success") {
                            $('#progress').hide();
                            if (fileInput[0].files && fileInput[0].files[0]) {
                                let reader = new FileReader();
                                reader.onload = function (e) {
                                    $('#profilePreview').css('background-image', 'url(' + e.target.result + ')');
                                    $('#profilePreview').hide();
                                    $('#profilePreview').fadeIn(650);
                                    $('.user-profile-header-logo').attr('src',e.target.result );
                                };
                                reader.readAsDataURL(fileInput[0].files[0]); // Use the file input reference here
                            }
                            ebook_alert_message(res.message, 'success');
                        } else {
                            ebook_alert_message('Error: ' + res.message, 'error');
                        }
                    },
                    error: function (xhr, status, error) {
                        ebook_alert_message('File upload failed: ' + error, 'error');
                    }
                });
            });

            // Social link toggle 
            $(".ebook-social-feilds ~ .ebook-input").slideUp();
            $('.ebook-social-feilds input[type="checkbox"]').change(function() {
                var isChecked = $(this).prop('checked');
                var inputField = $(this).closest('.ebook-social-type').find('.ebook-input');
                if (isChecked) {
                    inputField.slideDown(); // Show input field with sliding animation
                } else {
                    inputField.slideUp(); // Hide input field with sliding animation
                }
            });

            $(document).on('click','.user-update-password',function(){
                var formData = new FormData($(this).closest('.form')[0]);
                 // Clear previous error messages
               
                // Validate User Name
                let userName = $(this).parents('.form').find('input[name="user-name"]').val().trim();
                if (userName === '') {
                   ebook_alert_message('The user name is empty Please enter a user name','error');
                   return false;
                }

                // Validate Current Password
                let currentPassword = $(this).parents('.form').find('input[name="password"]').val().trim();
                if (currentPassword !== '') {
                    // Validate New Password
                    let newPassword = $(this).parents('.form').find('input[name="Cpassword"]').val().trim();
                    if (newPassword === '') {
                        ebook_alert_message('New password  is empty Please enter a New password ','error');
                        return false;
                    }
                    // ebook_alert_message('Current password  is empty Please enter a current password ','error');
                    // return false;
                }

                LoaderIN();
                $.ajax({
                    type:'post',
                    url: BASEURL + 'update-password',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success:function(response){
                        let res = jQuery.parseJSON(response);
                        if (res.status === 1) {                                                     
                            ebook_alert_message(res.msg,'success');
                           setTimeout(function(){ window.location.reload();},1000);
                        }else{
                            ebook_alert_message(res.msg,'error');                            
                        }
                        LoaderOut();
                    },
                    error:function(error){

                    }                
                });
            });
        },
        /*********************************************
        	User Managing Screen
        ********************************************-*/
        users: function() {            
            /** User Stats update ajax **/
            $(document).on('change', '.ebook-user-status', function() {              
                var id = $(this).parents('tr').attr('data-userid');
                LoaderIN();
                $.ajax({
                    url: BASEURL+'change-user-status',
                    data: {
                        'id': id,
                        'status': $(this).is(':checked')
                    },
                    type: "post",
                    success: function(response) { 
                        LoaderOut();
                        var res = jQuery.parseJSON(response);                        
                        if (res.status == '1') {
                           setTimeout(function(){ ebook_alert_message('User status has been updated successfully.', 'success');},1200);
                        } else {
                            setTimeout(function(){ ebook_alert_message('Something is going wrong please try again.', 'error');},1200);                            
                        }
                       
                    }
                });
            });
           
            /*********************************************
                User Moodule Add & Update
            *********************************************/
            $(document).on('click','.ebook-user-add, .ebook-user-update', function() {                
                var data = {};
                var obj = $(this);
                $(this).parents('form').find('.ebook-input').each(function(i) {
                    if ($(this).val().length == 0) {
                        if (obj.attr('id') == 'ebook-update-user' && $(this).attr('name') == 'password') {
                            //nothing heppen here                           
                        } else {
                            $(this).addClass('ebook-input-error');
                        }
                    } else {
                        var key = $(this).attr('name');
                        data[key] = $(this).val();
                    }
                });

                var email = $(this).parents('form').find('input[name="email"]').val();
             
                if (!ebookValidateEmail(email)) {
                    $(this).parents('form').find('input[name="email"]').addClass('ebook-input-error');
                    ebook_alert_message('Please enter valid email.', 'error');
                    setTimeout(function() {
                        $('input').removeClass('ebook-input-error');
                    }, 5000);                    
                    return false;
                }

                if ($('.ebook-input-error').length != 0) {
                    setTimeout(function() {
                        $('.ebook-input').removeClass('ebook-input-error');
                    }, 5000);
                    ebook_alert_message('All fields are required.', 'error');                    
                    return false;
                }

                if ($('#subuserplan').length != 0) {
                    data['plan'] = $('#subuserplan').val();
                } else {
                    var plan = [];
                    $('input[name="access_level[]"]:checked').each(function() {
                        plan.push($(this).val());
                    });

                    if (plan.length == 0) {
                        ebook_alert_message('Please select plan according to the purchase.', 'error');                        
                        return false;
                    }
                    data['plan'] = plan.toString();
                }
                data['ID'] = $(this).attr('data-id');
                var sendmail = $(this).parents('form').find('input[name="send_email"]:checked').val();
                 LoaderIN();
                $.ajax({
                    url: BASEURL + 'user-add',
                    data: {
                        'data': JSON.stringify(data),
                        'sendmail': sendmail != undefined ? true : false,
                        'action': $(this).attr('id') == 'ebook-update-user' ? 'update_user' : 'add_user'
                    },
                    type: "post",
                    success: function(response) {
                        var resp = $.parseJSON(response); 
                        setTimeout(function(){ LoaderOut();},1000);
                        if(resp.status==4){
                             ebook_alert_message('This feature is currently disabled, you can use it after '+resp.date, 'error');
                        }else if (resp.status==3) {
                            ebook_alert_message('The team creation limit has been exceeded. Please upgrade your plan.', 'error');
                        } else if (resp.status==1) {
                            ebook_alert_message('User has been added successfully.', 'success');
                            setTimeout(function(){window.location.reload();},1000);
                            return false;
                        } else if (resp.status==5) {
                            ebook_alert_message('User data has been updated successfully.', 'success');
                            setTimeout(function(){window.location.reload();},1000);
                            return false;
                        } else if (resp.status==2) {
                            ebook_alert_message('Email already exist, please try different vaild email address.', 'error');
                        } else {
                            ebook_alert_message('Something is going wrong please try again.', 'error');
                        }   
                        
                    }
                });

            });

            /*********************************************
                Update userid in confirm modal ajax
            *********************************************/
           
            $('#users-delete-selected').on('click', function() {
                $('#deleteConfirmModal').modal('show');
                $('#ebook-remove-user').attr('data-userid', 'selected');
            });

            $(document).on('click', '.ebookremoveuser', function() {
                $('#deleteConfirmModal').modal('show');
                var userid = $(this).attr('data-id');
                $('#ebook-remove-user').attr('data-userid',userid);
            });

            /*********************************************
                Delete User Ajax
            *********************************************/

            $(document).on('click', '.ebook-remove-user', function() {
                var res = $(this).text();
                if (res == 'Delete') {
                    var userid = $(this).attr('data-userid');

                    if (userid == 'selected') {
                        userid = '';
                        $('#UserTable').find('.eb-user-check').each(function() {
                            if ($(this).prop('checked') == true) {
                                userid += $(this).parents('tr').attr('data-userid') + ',';
                            }
                        });
                    }
                    LoaderIN();
                    $.ajax({
                        url: BASEURL + 'user-delete',
                        data: {
                            'userid': userid
                        },
                        type: "post",
                        success: function(response) {
                            console.log(response);
                            setTimeout(function(){ LoaderOut();},1000);
                            if (response > 0) {
                                ebook_alert_message('Record has been removed successfully.', 'success');
                                setTimeout(function(){location.reload();},1000);
                            } else {
                                ebook_alert_message('Something is going wrong please try again.', 'error');
                            }                           
                        }
                    });
                } else {
                    $('#deleteConfirmModal').modal('hide');
                }
            });

            /*********************************************
                Generate Random Password
            *********************************************/
            
            $('.ebook-generate-password').on('click', function() {
                var result = '';
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                var charactersLength = characters.length;
                for (var i = 0; i < 6; i++) {
                    result += characters.charAt(Math.floor(Math.random() * charactersLength));
                }
                $(this).prev().addClass('ebook-input-value');
                $(this).prev().val(result);
            });

            /*********************************************
                Open User Update Modal
            *********************************************/
           
            $(document).on('click', '.user-edit-modal', function() {

                $('#editUser input:checkbox').each(function() {
                    $(this).prop('checked', false);
                });

                $('#ebook-update-user').attr('data-id',$(this).attr('data-id'));
                // Find the parent <tr> and get the 'data-userinfo' attribute
                let userInfo = $(this).closest('tr').data('userinfo');
                
                // Parse the JSON data (as data-userinfo is stored as JSON string)
                let userData = typeof userInfo === "string" ? JSON.parse(userInfo) : userInfo;
                                
                $('#editUser').find('.ebook-input-wrapper').each(function() {
                    $(this).addClass('ebook-input-value');
                });

                $('#editUser').find('input[name="name"]').val(userData.name);
                $('#editUser').find('input[name="email"]').val(userData.email);
                console.log(userData.role);
                if (userData.role == '56&^^@##') {
                    $('#editUser').find('select[name="user_role"]').html('<option value="56&^^@##">Subuser</option>');
                } else if (userData.role == ':()#$99rrtR') {
                    $('#editUser').find('select[name="user_role"]').html('<option value=":()#$99rrtR">User</option>');
                }

                var plan = userData.access_level.split(',');
                $('#editUser .ebook-plan').val(plan);               
                $.each(plan, function(index, value) {
                    $('#editUser').find('input:checkbox[value=' + plan[index] + ']').prop('checked', true);
                });

            });
        }
    };    

    SimplEbookCreate.init();

    /*********************************************
        html form validation  
    *********************************************/
    function validate_form(target) {
        var check = 'valid';
        target.find('input , textarea , select').each(function() {
            var email = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;
            var url = /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;
            var websiteUrl = /^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/;
            var image = /\.(jpe?g|gif|png|PNG|SVG|svg|JPE?G)$/;
            var images = /\.(jpe?g|png|PNG|JPE?G)$/;
            var video = /\.(flv|avi|mov|mpg|wmv|m4v|mp4|mp3|wma|3gp)$/;
            var mobile = /((?:\+|00)[17](?: |\-)?|(?:\+|00)[1-9]\d{0,2}(?: |\-)?|(?:\+|00)1\-\d{3}(?: |\-)?)?(0\d|\([0-9]{3}\)|[1-9]{0,3})(?:((?: |\-)[0-9]{2}){4}|((?:[0-9]{2}){4})|((?: |\-)[0-9]{3}(?: |\-)[0-9]{4})|([0-9]{7}))/;
            var facebook = /^(https?:\/\/)?(www\.)?facebook.com\/[a-zA-Z0-9(\.\?)?]/;
            var twitter = /^(https?:\/\/)?(www\.)?twitter.com\/[a-zA-Z0-9(\.\?)?]/;
            var google_plus = /^(https?:\/\/)?(www\.)?plus.google.com\/[a-zA-Z0-9(\.\?)?]/;
            var number = /^[\s()+-]*([0-9][\s()+-]*){1,20}$/;
            var password = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&#])[A-Za-z\d$@$!%*?&#]{8,}$/;
            var pdfimage = /\.(pdf|PDF)$/;
            var float_num = /^[-+]?[0-9]+\.[0-9]+$/;
            var youtube = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/;
            var vimeo = /^.*((http|https)?:\/\/(www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|)(\d+)(?:|\/\?)).*/;
            var TagReg = /[<>`;&=+/()|^%*+]/g;
            var text_only = /^[a-zA-Z ]*$/g;

            var dropbox = /^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?([a-z0-9]+([\-\.]dropboxusercontent)|dropbox)\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/;
            var embed = /embed/g;
            var excel = /\.(xlsx)$/;
            if ($(this).hasClass('require')) {

                if ((typeof $(this).val() == 'object' && isEmpty($(this).val()) == true) || (typeof $(this).val() != 'object' && $(this).val().trim() == '')) {
                    ebook_alert_message('Some required fields are missing.', 'error');                    
                    $(this).addClass('error').focus();
                    if ($('.edu_accord_parent').length)
                        $(this).closest('.edu_accord_parent').addClass('error');
                    check = 'novalid';
                    return false;
                } else {
                    $(this).removeClass('error');
                    if ($('.edu_accord_parent').length)
                        $(this).closest('.edu_accord_parent').removeClass('error');
                    check = 'valid';
                }
            }

            if ((typeof $(this).val() == 'object' && isEmpty($(this).val()) == true) || (typeof $(this).val() != 'object' && $(this).val().trim() != '')) {
                var valid = $(this).attr('data-valid');
                if (typeof valid != 'undefined') {
                    if (!eval(valid).test($(this).val().trim())) {
                        $(this).addClass('error').focus();
                        toastr.error($(this).attr('data-error'));
                        check = 'novalid';
                        return false;
                    } else {
                        $(this).removeClass('error');
                        check = 'valid';
                    }
                }
            }

        });
        return check;
    }
    /*********************************************
        jQuery Validate Emails with Regex 
        (Function with global scop) 
    *********************************************/    
    function ebookValidateEmail(email) {
        var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
        return jQuery.trim(email).match(pattern) ? true : false;
    }
    function LoaderIN(){
        $(".status").fadeIn();
        $(".preloader").fadeIn("slow");
    }
    function LoaderOut(){
        $(".status").fadeOut();
        $(".preloader").delay(350).fadeOut("slow");
    }
    /*********************************************
        Read Image and set preview
    *********************************************/    
    function readURL(input, obj, apply_on) {
        if (input.files) {
            var filesAmount = input.files.length;

            if (filesAmount == 1) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    if (apply_on == 'src') {
                        if (obj == '') {
                            $('.vp-preview-gallery ul').append('<li><img src="' + e.target.result + '"></li>');
                        } else {
                            $(obj).attr('src', e.target.result);
                        }
                    } else {
                        $(obj).css('background-image', 'url(' + e.target.result + ')');
                    }
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                for (var i = 0; i < filesAmount; i++) {
                    var reader = new FileReader();
                    reader.onload = function(event) {
                        $('.vp-preview-gallery ul').append('<li><img src="' + event.target.result + '"></li>');
                    }
                    reader.readAsDataURL(input.files[i]);
                }
            }
        } else {
            alert('select a file to see preview');
        }
    }   
    /*********************************************
        Valid URL
    *********************************************/
    function validURL(str) {
        var pattern = new RegExp('^(https?:\\/\\/)?' + // protocol
            '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
            '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
            '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
            '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
            '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator
        return !!pattern.test(str);
    }
    /*********************************************
       Readu Function 
    *********************************************/
    $(document).ready(function(){

        
        
    });

    /*********************************************
        Alert Popup Common Function
    *********************************************/    
    function ebook_alert_message(msg, msg_status) {
        $('.ebook-alert-body').text(msg);
        $('.ebook-alert-wrap').addClass("ebook-"+msg_status);

        setTimeout(function() {
            $('.ebook-alert-wrap').removeClass("ebook-"+msg_status);
            if ($('.sec-input-error').length != 0) {
                $('input').removeClass('sec-input-error');
            }
        }, 5000);
    }
})(jQuery);